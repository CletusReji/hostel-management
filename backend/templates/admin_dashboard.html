{% extends "base.html" %}

{% block content %}
<h1>Admin Dashboard</h1>

<div class="grid">
    <div class="card">
        <h3>Occupancy Stats</h3>
        <p style="font-size: 2rem;">{{ occupied }} / {{ total }} Rooms</p>
    </div>

    <div class="card">
        <h3>Assign Monthly Rent</h3>
        <form method="POST" action="{{ url_for('assign_rent') }}" class="flex">
            <!-- Dropdown for Month -->
            <select name="month" required>
                <option value="" disabled selected>Select Month</option>
                <option value="January">January</option>
                <option value="February">February</option>
                <option value="March">March</option>
                <option value="April">April</option>
                <option value="May">May</option>
                <option value="June">June</option>
                <option value="July">July</option>
                <option value="August">August</option>
                <option value="September">September</option>
                <option value="October">October</option>
                <option value="November">November</option>
                <option value="December">December</option>
            </select>

            <!-- Dropdown for Year -->
            <select name="year" required>
                <option value="2024">2024</option>
                <option value="2025" selected>2025</option>
                <option value="2026">2026</option>
            </select>

            <input type="number" name="amount" placeholder="Amount (Rs.)" required>
            <button type="submit">Publish Rent</button>
        </form>
    </div>
</div>

<div class="grid">
    <div class="card" style="border: 1px solid #f59e0b;">
        <h3 style="color: #f59e0b;">Pending Dues</h3>
        {% if pending_dues %}
        <table style="width: 100%; text-align: left; border-collapse: collapse;">
            <thead>
                <tr style="border-bottom: 1px solid #475569;">
                    <th style="padding: 0.5rem;">Student</th>
                    <th style="padding: 0.5rem;">Room</th>
                    <th style="padding: 0.5rem;">Amount</th>
                    <th style="padding: 0.5rem;">Action</th>
                </tr>
            </thead>
            <tbody>
                {% for d in pending_dues %}
                <tr style="border-bottom: 1px solid #334155;">
                    <td style="padding: 0.5rem;">{{ d.name }}</td>
                    <td style="padding: 0.5rem;">{{ d.room }}</td>
                    <td style="padding: 0.5rem; color: #ef4444; font-weight: bold;">Rs. {{ d.amount }}</td>
                    <td style="padding: 0.5rem;">
                        <a href="{{ url_for('student_details', id=d['id']) }}"
                            style="color: #60a5fa; text-decoration: none;">View & Pay</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <p style="color: #10b981;">No pending dues!</p>
        {% endif %}
    </div>
</div>

<div class="grid">
    <div class="card">
        <h3>Student List</h3>
        {% for s in users %}
        <div class="student-item flex" style="align-items: center;">
            <div>
                <strong>{{ s.full_name }}</strong> (Room {% if s.room %}{{ s.room.room_number }}{% else %}N/A{% endif
                %})
            </div>
            <div>
                <a href="{{ url_for('student_details', id=s.id) }}" class="badge"
                    style="background: var(--primary); color: white; text-decoration: none;">View Details / Manage
                    Rent</a>
            </div>
        </div>
        {% else %}
        <p>No students registered.</p>
        {% endfor %}
    </div>

    <div class="card">
        <h3>All Complaints</h3>
        {% for c in complaints %}
        <div class="complaint-item">
            <div class="flex">
                <strong>{{ c.title }} <small>({{ c.student.full_name }})</small></strong>
                {% if c.status == 'Pending' %}
                <a href="{{ url_for('resolve_complaint', id=c.id) }}" class="badge"
                    style="background: white; color: black; text-decoration: none;">Mark Resolved</a>
                {% else %}
                <span class="badge Resolved">Resolved</span>
                {% endif %}
            </div>
            <p>{{ c.description }}</p>
            {% if c.image_file %}
            <div style="margin-top: 0.5rem;">
                <a href="{{ url_for('static', filename='uploads/' + c.image_file) }}" target="_blank"
                    style="color: #60a5fa; font-size: 0.9rem;">View Attachment</a>
            </div>
            {% endif %}
        </div>
        {% else %}
        <p>No complaints.</p>
        {% endfor %}
    </div>
</div>
{% endblock %}